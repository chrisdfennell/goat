# Disable Apache content negotiation (prevents conflicts with clean URLs)
Options -MultiViews

RewriteEngine On
RewriteBase /

# 301 redirect /index.php → /
RewriteCond %{THE_REQUEST} \s/index\.php[\s?] [NC]
RewriteRule ^index\.php$ / [R=301,L]

# 301 redirect /sitemap.php → /sitemap.xml (only on *direct* requests)
RewriteCond %{THE_REQUEST} \s/sitemap\.php[\s?] [NC]
RewriteRule ^sitemap\.php$ sitemap.xml [R=301,L]

# Serve real files/dirs directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Exclude static/secure dirs
RewriteRule ^assets/ - [L]
RewriteRule ^includes/ - [L]

# INTERNAL rewrite: pretty /sitemap.xml uses sitemap.php (no physical XML file)
RewriteRule ^sitemap\.xml$ sitemap.php [L]

# Redirect direct access to numbered page files → pretty URL
RewriteRule ^pages/([0-9]+)-(.*)\.php$ /$2 [R=301,L]

# Home
RewriteRule ^$ index.php [L]

# Catch-all router → pages.php
RewriteRule ^(.+?)/?$ pages.php?slug=$1 [QSA,L]